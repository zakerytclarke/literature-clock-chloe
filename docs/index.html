<script>
    var current_date; 

    async function fetchCurrentTime() {
        const response = await fetch('https://worldtimeapi.org/api/timezone/America/New_York');
        if (!response.ok) {
            console.error('Failed to fetch time from WorldTimeAPI');
            return new Date(); // Fallback to the local time
        }
        const data = await response.json();
        return new Date(data.datetime);
    }

    async function startTime(sfw) {
        // Fetch New York time
        const time = await fetchCurrentTime();

        if (current_date !== undefined && current_date.getMinutes() === time.getMinutes()) {
            // Skip updates if the minute hasn't changed
            setTimeout(() => startTime(sfw), 30000);
            return;
        }

        current_date = time; // Update current_date for new interval
        updateText(time, sfw);

        // Timeout for the next API call (30 seconds)
        setTimeout(() => startTime(sfw), 30000);
    }

    function oneMinuteAgo(time) {
        return new Date(time - 60000); // Subtract one minute
    }

    function timeToTimecode(time) {
        var h = time.getHours();
        var m = time.getMinutes();
        h = checkTime(h);
        m = checkTime(m);
        return h + "_" + m;  // fixed for windows compatibility
    }

    function checkTime(i) {
        if (i < 10) { i = "0" + i };  // add zero in front of numbers < 10
        return i;
    }
</script>
